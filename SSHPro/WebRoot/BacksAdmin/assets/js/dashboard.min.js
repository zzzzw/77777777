/*
Template Name: Color Admin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.2.0
Version: 1.4.0
Author: Sean Ngu
Website: http://www.seantheme.com/color-admin-v1.4/
*/
var blue="#348fe2",
blueLight="#5da5e8",
blueDark="#1993E4",
aqua="#49b6d6",
aquaLight="#6dc5de",
aquaDark="#3a92ab",
green="#00acac",
greenLight="#33bdbd",
greenDark="#008a8a",
orange="#f59c1a",
orangeLight="#f7b048",
orangeDark="#c47d15",
dark="#2d353c",
grey="#b6c2c9",
purple="#727cb6",
purpleLight="#8e96c5",
purpleDark="#5b6392",
red="#ff5b57",
golden="#CDCD00",
silver="#B2DFEE",
common="#B5B5B5",
allmap=0;
var allcity=new Array(2); 
										

function line(data,label,color,lines,points,shadowSize){
    this.data = data;
    this.label = label;
    this.color = color;
    this.lines = lines;
    this.points = points;
    this.shadowSize = shadowSize;
}

var company1
var company2
		
		//json 的转换
		function change(v){
		var p=v.split(',');
			
		var t=[[Number(p[0]),Number(p[1])],
		[Number(p[2]),Number(p[3])],
		[Number(p[4]),Number(p[5])],
		[Number(p[6]),Number(p[7])],
		[Number(p[8]),Number(p[9])],
		[Number(p[10]),Number(p[11])],
		[Number(p[12]),Number(p[13])],
		[Number(p[14]),Number(p[15])],
		[Number(p[16]),Number(p[17])],
		[Number(p[18]),Number(p[19])],
		[Number(p[20]),Number(p[21])],
		[Number(p[22]),Number(p[23])]
		]
			return t;
		}
		
		//颜色选择器
		function select(i){
			if(i==1)
			 return red;
			else if(i==2)
			return  green;
			else if(i==3)
			return  orange;
			else if(i==4)
			return  dark;
			else if(i==5)
			return  blue;
			else if(i==6)
			return  purple;
			else 
			return  grey;
		}
		
		
		//数据封装
		function fenzhuan(response){
			
			var ob=[];
			var a=Object.keys(response)		
			for(var i=1;i<=a.length-1;){
				ob.push(new line(change(response[i+1]),response[i],select(i),{show:true,fill:false,lineWidth:2},{show:true,radius:3,fillColor:"#fff"},0));
				i=i+2;
			}
			
			return ob;
			
		}


var handleVectorMap=function(){
	"use strict";
	if($("#world-map").length!==0){
		$("#world-map").vectorMap({
			map:"china_ch",
			scaleColors:["#e74c3c","#0071a4"],
			normalizeFunction:"polynomial",
			hoverOpacity:.5,
			hoverColor:false,
			markerStyle:{
					initial:{
						fill:"#4cabc7",
						stroke:"transparent",r:3
						     }
						},
			regionStyle:{
				initial:{
					fill:"rgb(97,109,125)",
					"fill-opacity":1,
					stroke:"none",
					"stroke-width":.4,
					"stroke-opacity":1
					    },
					hover:{"fill-opacity":.8},
					selected:{fill:"red",color:red},
					selectedHover:{}
					    },
						
					onRegionClick: function(event, code){
　　　　　　				 if(allmap==0){
							allcity[0]=code
							allmap++
							}else{
								allcity[1]=code
//								$('#quickquery').modal('show')
								$("#mytbody").empty();
								 $.ajax( {
										type : 'POST',
										dataType : 'json', // json对象
										data: {scity:allcity[0], ecity:allcity[1]},
										url : 'main-manager!querybycity.action',
								success : function(response, status, xhr) {			
									var q="";
									 $.each(response,function(index,value){	
									q+='<tr><td><i class="glyphicon glyphicon-plane"></i>'+value[1]+'<br>'
									q+='<input type="hidden" value="'+value[15]+'" name="entity.id"/>'		
									q+='<input type="hidden" value="'+value[1]+'" name="hangban"/>'
									q+='<input type="hidden" value="'+value[7]+'" id="a001"/>'
									q+='<input type="hidden" value="'+value[9]+'" id="a002"/>'
									q+='<input type="hidden" value="'+value[11]+'" id="a003"/>' 	
			 						q+=' <input type="hidden" value="'+value[13]+'" id="a004"/>'	
										
			 						q+=' <input type="hidden" value="'+value[17]+'" id="b001"/>'		
			 						q+=' <input type="hidden" value="'+value[18]+'" id="b002"/>'		
			 						q+=' <input type="hidden" value="'+value[19]+'" id="b003"/>'		
			 						q+=' <input type="hidden" value="'+value[20]+'" id="b004"/>'
									
									q+='<input type="hidden" value="'+value[1]+'" name="seatnum.lname"/>'		
									q+='<input type="hidden" value="'+value[7]+'" name="seatnum.tdcnum"/>'		
									q+='<input type="hidden" value="'+value[9]+'" name="seatnum.swcnum"/>'		
									q+='<input type="hidden" value="'+value[11]+'" name="seatnum.jjcnum"/>'		
									q+='<input type="hidden" value="'+value[13]+'" name="seatnum.thcnum"/>'		
									q+='<input type="hidden" value="'+value[21]+'" name="seatnum.id"/>'		
									q+='<input type="hidden" value="'+value[22]+'" name="seatnum.planedate"/></td>'		
									var s1=value[3].substring(11)		
									var s2=value[5].substring(11)		
									q+='<td>'+value[2]+'----'+value[4]+'<br>'+s1+'&nbsp;&nbsp;&nbsp;&nbsp; '+s2+'</td>'			
			 			 		
									q+='<td><input type="radio" value="头等舱"  id="a0011" name="radio1" /><s:property value="'+value[6]+'" /></td>'
									q+='<td><input type="radio" value="商务舱"  id="a0021" name="radio1" /><s:property value="'+value[8]+'" /></td>'
									q+='<td><input type="radio" value="经济舱"  id="a0031" name="radio1" /><s:property value="'+value[10]+'" /></td>'
									q+='<td><input type="radio" value="特惠舱"  id="a0041" name="radio1" /><s:property value="'+value[12]+'" /></td>'
									q+='<td><input type="submit" value="预定" id="yuding" class="btn btn-info"></td></tr>'
									
									 });
								$("#mytbody").append(q);
			 			 		$('#quickquery').modal('show')			
      		     				allmap=0;
								},
							error : function() {
								alert("加载失败");
								alert(XMLHttpRequest.status);
          						  alert(XMLHttpRequest.readyState);
           						 alert(textStatus);
								}
							})	
								
								
								
								
								
							}
							
						
						
							
							
　　　　					},						
					focusOn:{
						x:.5,y:.5,scale:0
						    },
					backgroundColor:"#2d353c",
					markers:[
					
					{   
					    latLng:[25,123],
						name:"钓鱼岛"
					},
					{
						latLng:[20,166],
						name:"东沙群岛"
					},
					{
						latLng:[4,112.21],
						name:"曾母暗沙"
					}
					
				]})
					}
};
					
					
					var handleInteractiveChart=function(){
						
						"use strict";
						
						
 					$.ajax( {
							type : 'POST',
							dataType : 'json', // json对象
							url : 'main-manager!defaultsale.action',
							success : function(response, status, xhr) {
								
								function e(e,t,n){
							$('<div id="tooltip" class="flot-tooltip">'+n+"</div>").css(
							   {top:t-45,left:e-55}).appendTo("body").
							   fadeIn(200)
							   }
								
											
		
							
		 
		 					  if($("#interactive-chart").length!==0)
							   {
							   		
									
//							   		var t=change(response[2])
//									var n=change(response[4])
//									
//									var qwe=new line(t,response[1],red,{show:true,fill:false,lineWidth:2},{show:true,radius:3,fillColor:"#fff"},0);
									
									var result=fenzhuan(response);
									
//									var ob=[
//									{
//										data:t,
//										label:response[1],
//										color:blue,
//										lines:{show:true,fill:false,lineWidth:2},
//										points:{show:true,radius:3,fillColor:"#fff"},
//										shadowSize:0
//									 },
//										
//										{
//											data:n,
//											label:response[3],
//											color:green,
//											lines:{show:true,fill:false,lineWidth:2},
//											points:{show:true,
//													radius:3,
//													fillColor:"#fff"
//													},
//											shadowSize:0
//										}
//									];
									
//									ob.push(qwe)
									var r=[[1,"一月&nbsp;"],[2,"二月&nbsp;"],[3,"三月&nbsp;"],[4,"四月&nbsp;"],[5,"五月&nbsp;"],[6,"六月&nbsp;"],[7,"七月&nbsp;"],
										[8,"八月&nbsp;"],[9,"九月&nbsp;"],[10,"十月&nbsp;"],[11,"十一月&nbsp;"],[12,"十二月&nbsp;"]];
										
										
									
										
										
							
										
										
										
									$.plot($("#interactive-chart"),
									//数据赋值
									
									
								    result,
										//x,y轴数据初始化
										{
											xaxis:{
												ticks:r,
												tickDecimals:0,
												tickColor:"#ddd"
												  },
											yaxis:{
												ticks:10,
												tickColor:"#ddd",
												min:0,
												max:response['max']
												   },
											grid:{
												hoverable:true,
												clickable:true,
												tickColor:"#ddd",
												borderWidth:1,
												backgroundColor:"#fff",
												borderColor:"#ddd"
												},
											legend:{
												labelBoxBorderColor:"#ddd",
												margin:10,
												noColumns:1,
												show:true
												   }
												 });
									 
												   var i=null;
										$("#interactive-chart").bind("plothover",function(t,n,r){
											
											$("#x").text(n.x.toFixed(2));
											$("#y").text(n.y.toFixed(2));
											if(r){
												if(i!==r.dataIndex){
													i=r.dataIndex;
													$("#tooltip").remove();
													var s=r.datapoint[1].toFixed(2);
													var o=r.series.label+" "+s;e(r.pageX,r.pageY,o)
																	}
												 }else{
												 	$("#tooltip").remove();
													i=null
													  }
												t.preventDefault()
												}
												
												
												)}
				
	
	
					
		
  		     				
							},
						error : function() {
									alert("加载失败");
									alert(XMLHttpRequest.status);
     								   alert(XMLHttpRequest.readyState);
      								  alert(textStatus);
								}
							})	
							
							
						
							   
							   
							 
												
												
												
												
};
												
												
					var handleDonutChart=function(){
													"use strict";
														 $.ajax({
																	 type:'POST',
																	 dataType:'json',  //json对象
																	 url:'main-manager!queryleaguer.action',
																	 data:$("#form1").serialize(),
																	 success:function(response,status,xhr){	
		 
		    										if($("#donut-chart").length!==0){
														var e=[ {
																label:"金牌会员",
																data:response[1],
																color:golden
																},
															    {
																label:"银牌会员",
																data:response[2],
																color:silver
																},
																{
																label:"普通会员",
																data:response[3],
																color:common
																}];
																$.plot("#donut-chart",e,
																	{series:
																		{pie:
																			{
																				innerRadius:.5,
																				show:true,
																				label:{show:true}
																			}
																		},
																	legend:{show:true}
																	})}
	       
		 
		 
		
		 
		 
		 
	 																	},
																error:function(XMLHttpRequest, textStatus, errorThrown){
		          													      alert("加载失败"); 
		            													    alert(XMLHttpRequest.status);
                       														 alert(XMLHttpRequest.readyState);
                       															 alert(textStatus);
	 																		} 
		 
																	 }) 
													
													
													
												
																	
																	
																	};
																	
																	
				var handleDashboardSparkline=function(){
					"use strict";function t(){
						var t=[50,30,45,40,50,20,35,40,50,70,90,40];
						e.type="line";
						e.height="23px";
						e.lineColor=red;
						e.highlightLineColor=red;
						e.highlightSpotColor=red;
						
						var n=$("#sparkline-unique-visitor").width();
						if(n>=200){
							e.width="200px"
								   }
						else{
						  e.width="100%"
						    }
					$("#sparkline-unique-visitor").sparkline(t,e);
					e.lineColor=orange;
					e.highlightLineColor=orange;
					e.highlightSpotColor=orange;
					
					$("#sparkline-bounce-rate").sparkline(t,e);
					e.lineColor=green;
					e.highlightLineColor=green;
					e.highlightSpotColor=green;
					
					$("#sparkline-total-page-views").sparkline(t,e);
					e.lineColor=blue;
					e.highlightLineColor=blue;
					e.highlightSpotColor=blue;
					$("#sparkline-avg-time-on-site").sparkline(t,e);
					e.lineColor=grey;
					e.highlightLineColor=grey;
					e.highlightSpotColor=grey;
					$("#sparkline-new-visits").sparkline(t,e);
					e.lineColor=dark;
					e.highlightLineColor=dark;
					e.highlightSpotColor=grey;
					
					$("#sparkline-return-visitors").sparkline(t,e)
					}
					
					
					var e={
						   height:"50px",
						   width:"100%",
						   fillColor:"transparent",
						   lineWidth:2,
						   spotRadius:"4",
						   highlightLineColor:blue,
						   highlightSpotColor:blue,
						   spotColor:false,
						   minSpotColor:false,
						   maxSpotColor:false
						   };
						   
						   t();
						   
						   $(window).on("resize",function(){
						   	$("#sparkline-unique-visitor").empty();
							$("#sparkline-bounce-rate").empty();
							$("#sparkline-total-page-views").empty();
							$("#sparkline-avg-time-on-site").empty();
							$("#sparkline-new-visits").empty();
							$("#sparkline-return-visitors").empty();
							t()
							})};
							
							var handleDashboardDatepicker=function(){
								"use strict";
								$("#datepicker-inline").datepicker({todayHighlight:true})
								};
								
								
							var handleDashboardTodolist=function(){
								"use strict";
								$("[data-click=todolist]").click(function(){
									var e=$(this).closest("li");
									if($(e).hasClass("active")){
										$(e).removeClass("active")
										}
									else{
										$(e).addClass("active")}})
										};
	
											
							var Dashboard=function(){
								"use strict";
								return{
									init:function(){
										
										handleInteractiveChart();
										handleDashboardSparkline();
										handleDonutChart();
										handleDashboardTodolist();
										handleVectorMap();
										handleDashboardDatepicker()
													}
													}
									}()